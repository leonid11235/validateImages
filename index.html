<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Custom App Image Validator</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/6.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.0/firebase-storage.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <!-- Dropbox api -->
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="tlvf8xcd30wdyaf"></script>
  <!-- Jquery -->
  <script
  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
  crossorigin="anonymous"></script>
  <!-- Fontawesome -->
  <script src="https://kit.fontawesome.com/5e353a2baf.js"></script>
  <style>
    .thumbnail {
      width: 50px;
      margin-left: 10px;
    }
    .row .col {
      margin: 0;
      padding: 0;
    }
    #bl-logo {
      width: 200px;
      margin-left: -20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <img id="bl-logo" src="logo-BuildingLink-CMYK-Black-Red-taglineUnder-forLetterhead.png" alt="BuildingLink Logo">
    <h2>Custom App Media Validator - <span class="grey-text text-darken-1">Android</span></h2>
    
    <form>
      <h5>1. App Icon</h5>
      <div class="row">
        <div class="col s10">       
          <div class="file-field input-field" id="appicon">
            <div class="btn">
              <span>File</span>
              <input type="file">
            </div>
            <div class="file-path-wrapper">
              <input class="file-path validate" id="app-icon" name="appicon" type="text" onchange="selectImg('app-icon-img', 'appicon', 500, 500)">
            </div>
          </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" id="app-icon-img" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <h5>2. Splash screen 9-patch image with the following resolution</h5>
      <p>Portrait mode</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field" id="portrait">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="selectImg('portrait-img', 'portrait', 500, 500)">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" id="portrait-img" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>MDPI = 320x480px</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field" id="MDPI">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="selectImg('MDPI-img', 'MDPI', 500, 500)">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" id="MDPI-img" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>LDPI = 240x360px * HDPI = 480x720px</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field" id="LDPI">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="selectImg('LDPI-img', 'LDPI', 500, 500)">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" id="LDPI-img" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>XHDPI = 640x960px</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>XXHDPI = 960x1440px</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>XXXHDPI = 1280x1920px</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <h5>3. Login screentop logo 1x9 SVG image</h5>  
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <h5>4. Google play metadata</h5>
      <div class="row">
        <div class="input-field col s12">
          <textarea id="textarea1" class="materialize-textarea" data-length="120"></textarea>
          <label for="textarea1">App name</label>
        </div>
        <div class="input-field col s12">
          <textarea id="textarea2" class="materialize-textarea overflown" data-length="120"></textarea>
          <label for="textarea2">Account for screenshots (normally support provides)</label>
        </div>
        <div class="input-field col s12">
            <textarea id="textarea3" class="materialize-textarea" data-length="120"></textarea>
            <label for="textarea3">App Description For Google Play</label>
        </div>
        <div class="input-field col s12">
            <textarea id="textarea4" class="materialize-textarea" data-length="120"></textarea>
            <label for="textarea4">Short Description for Google Play</label>
        </div>
      </div>

      <p>Feature Graphic - 1024x500px JPG or 24-bit PNG (no-alpha)</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <p>Hi-res icon - 512x512px 32bit PNG (with alpha)</p>
      <div class="row">
        <div class="col s10">
          <div class="file-field input-field">
              <div class="btn">
                <span>File</span>
                <input type="file">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="" onchange="">
              </div>
            </div>
        </div>
        <div class="col s2">
          <img src="Blank_Page-512.png" class="thumbnail" alt="Image preview...">
        </div>
      </div>

      <!--Add buttons to initiate auth sequence and sign out-->
      <!-- <h5>Google Drive</h5>
      <button id="authorize_button" class="btn">Authorize</button>
      <button id="signout_button" class="btn">Sign Out</button>
      <pre id="content" style="white-space: pre-wrap;"></pre> -->
  </form>

  <button class="btn waves-effect waves-light" onclick="submitBtn()">Submit <i class="far fa-share-square"></i>
  </button>
  <br><br>
  <div id="dropbox-btn"></div>
  <br><br>

  </div>

<!-- <script type="text/javascript" src="drive.js"></script> -->
<script type="text/javascript" src="dropbox.js"></script>
<!-- <script async defer src="https://apis.google.com/js/api.js"
  onload="this.onload=function(){};handleClientLoad()"
  onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script> -->
<script>
// Author: Leonid Uvarov
// NOTES: Create function for validateDimensions, separate firebase .js file?

// Global variables

// FIREBASE STORAGE
// Your web app's Firebase configuration
var firebaseConfig = {
  apiKey: "AIzaSyBLfWdcEoARKEdbvya0evqMHRBPtzAk1sc",
  authDomain: "image-upload-46ec6.firebaseapp.com",
  databaseURL: "https://image-upload-46ec6.firebaseio.com",
  projectId: "image-upload-46ec6",
  storageBucket: "image-upload-46ec6.appspot.com",
  messagingSenderId: "820672852461",
  appId: "1:820672852461:web:bc97989838fc9702"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Array to store local file url's
localFiles =  [

];

function selectImg(imgDomId, wrapperId, valHeight, valWidth) {
  var wrapper = document.getElementById(wrapperId);
  var preview = document.getElementById(imgDomId);//selects the query named img
  var file    = wrapper.querySelector('input[type=file]').files[0];
  var name    = wrapperId;
  var namePng = name + ".png";

  var reader  = new FileReader();
  reader.onload = function (e) {

    //Initiate the JavaScript Image object.
    var image = new Image();
    //Set the Base64 string return from FileReader as source.
    image.src = e.target.result;

    //Validate the File Height and Width.
    image.onload = function () {

      // validateImgSize(this.width, this.height, width, height, size, this.size);
      var height = this.height;
      var width = this.width;
      if (height > valHeight || width > valWidth) {
        alert("Height and Width must not exceed " + valHeight +"px.");    
          return false;
      } else {
        console.log("Uploaded image has valid Height and Width.");
        localFiles.push({"url": file, "name": namePng});
        preview.src = reader.result;
      }

      return true;
    };
  }

  if (file) {
      reader.readAsDataURL(file); //reads the data as a URL
  } else {
      preview.src = "";
  }
}

// Creates a dropbox button 
function submitBtn() { 
  
  // Upload array of local URL's to Firebase
  uploadToFirebaseLoop();
  alert("Submited");
  createDropBoxBtn();
}

function uploadToFirebase(image, name){
  // Create a storage reference
  var storageRef = firebase.storage().ref('images/' + name);
  // Upload file - 
  var task = storageRef.put(image);

  task.on('state_changed', 
    function progress(snapshot) {console.log("successfully uploaded image to Firebase")},
    function error(err) {},
    function complete() {}
  )
}

// Upload all files in array to Google Firebase Storage
function uploadToFirebaseLoop() {

  for (var i = 0; i < localFiles.length; i++) {
    console.log("file: " + localFiles[i].url);
    uploadToFirebase(localFiles[i].url, localFiles[i].name);
  }
}

function loadDropboxURLs() {
  for (var i = 0; i < localFiles.length; i++ ) {
    alert(localFiles[0].name);
    alert(getFirebaseImgUrl(localFiles[0].name));
    options.files[i].url = getFirebaseImgUrl(localFiles[i].name);
    options.files[i].name =  localFiles[i].name;
  }
}

function getFirebaseImgUrl(name) {
  var storageRef = firebase.storage().ref('images/' + name);
  storageRef.getDownloadURL().then(function(url) {
    alert("firebase: " + url);
    return url;
  }).catch(function(error) {
    switch (error.code) {
    case 'storage/object-not-found':
      // File doesn't exist
      console.log("File doesn't exist")
      return false;
      break;
    case 'storage/unauthorized':
      // User doesn't have permission to access the object
      console.log("User doesn't have permission to access the object")
      return false;
      break;
    case 'storage/canceled':
      // User canceled the upload
      console.log("User canceled the upload")
      return false;
      break;
    case 'storage/unknown':
      // Unknown error occurred, inspect the server response
      console.log("Unknown error occurred, inspect the server response");
      return false;
      break;
    }
  });
}

// Pass the function parameters to check against, return false if fails
// Note: should be text on page, not alert
function validateImgSize(width, height, valWidth, valHeight, size, valSize) {
  if (width > valWidth || width > valWidth) {
    console.log("Height and Width must not exceed 100px."); 
    return false;
  }

  if (size > valSize) {
    console.log("File size is too large."); 
    return false;
  }

  return true;
}



// Update UI on validation
// Pass a 0 or 1 state, 
function updateUIVal(state, selector, errorMsg, succMsg) {
  var $el = $('#' + selector);
  if (state) {
    // Show success prompt
    $el.html("Success!");
    $el.addClass("imgSuccess");
    $el.removeClass("imgFail");
  } 
    // Show failed prompt
    $el.html("Failed: Check requirements above");
    $el.addClass("imgFail");
    $el.removeClass("imgSuccess");
}

// Function to validate file type
function validateImgFile(fileId){
    var fileInput = document.getElementById(fileId);
    var filePath = fileInput.value;
    var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif)$/i;
    if(!allowedExtensions.exec(filePath)){
        alert('Please upload file having extensions .jpeg/.jpg/.png/.gif only.');
        fileInput.value = '';
        return false;
    } else {
      return true;
    }
}

Document.onload = function() {
  // Adjust height for overflown labels on mobile
  if ($('.overflown')[0].scrollWidth >  $('.overflown').innerWidth()) {
    $('.overflown')[0].attr('height', 'auto')
  }
}



/*********************************
 * 
 *  UTILS
 * 
 * *******************************

/**
   * Creates a string that can be used for dynamic id attributes
   * Example: "id-so7567s1pcpojemi"
   * @returns {string}
*/
function uniqueNumber() {
  return 'id-' + Math.random().toString(36).substr(2, 16);
}

function createName(str) {
  newStr = str.replace(/-/g, "");
  return newStr;
}

// Temporary func: set the URL for dropbox button (image to save)
function setDBUrl(url) {
  $('#dropbox-saver-id').attr('href', url);
}

</script>
</body>
</html>
